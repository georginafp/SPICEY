<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Measuring tissue specificity from single cell data with SPICEY • SPICEY</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Measuring tissue specificity from single cell data with SPICEY">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SPICEY</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/SPICEY.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/georginafp/SPICEY/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Measuring tissue specificity from single cell data with SPICEY</h1>
                        <h4 data-toc-skip class="author">Georgina
Fuentes-Páez</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/georginafp/SPICEY/blob/HEAD/vignettes/SPICEY.Rmd" class="external-link"><code>vignettes/SPICEY.Rmd</code></a></small>
      <div class="d-none name"><code>SPICEY.Rmd</code></div>
    </div>

    
    
<p><img src="../reference/figures/logo_spicey.png" width="10%" style="display: block; margin: auto;"></p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>SPICEY is an R package designed to infer cell type specificity from
single-cell omics data. It supports input from widely used frameworks
such as Seurat (for single-cell RNA-seq) and Signac (for single-cell
ATAC-seq), and computes metrics of cell-type specificity at both the
regulatory and transcriptional levels.</p>
<div class="section level3">
<h3 id="preamble">Preamble<a class="anchor" aria-label="anchor" href="#preamble"></a>
</h3>
<p>SPICEY is designed to operate on the results of differential analyses
performed on either single-cell ATAC-seq (for chromatin accessibility)
or single-cell RNA-seq (for gene expression) data. These analyses would
compare each feature—either a regulatory element (e.g., peak) or
gene—across cell types to identify cell-type-specific activity or
expression. SPICEY takes advantage of the resulting statistics,
specifically the <strong>log2 fold-change</strong> and associated
<strong>adjusted p-values</strong>, which reflect both the magnitude and
statistical confidence of differential activity. By leveraging these
pre-computed differential results, SPICEY quantifies cell-type
specificity through composite metrics that capture both the strength and
selectivity of feature enrichment in individual cell types.</p>
</div>
<div class="section level3">
<h3 id="cell-type-specificity-indices-retsi-and-getsi">Cell-Type Specificity Indices: RETSI and GETSI<a class="anchor" aria-label="anchor" href="#cell-type-specificity-indices-retsi-and-getsi"></a>
</h3>
<p>SPICEY introduces two complementary metrics:</p>
<ul>
<li>RETSI (Regulatory Element Tissue Specificity Index): Quantifies the
cell-type specificity of regulatory regions between cell types (e.g.,
ATAC-seq peaks).</li>
</ul>
<!-- --><ul>
<li>GETSI (Gene Expression Tissue Specificity Index): Quantifies the
specificity of gene expression across distinct cell types.</li>
</ul>
<p>Both RETSI and GETSI are calculated using a weighted specificity
score for each feature (regulatory region or gene), defined as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>S</mi><msub><mi>I</mi><mrow><mi>i</mi><mo>,</mo><mi>x</mi></mrow></msub><mo>=</mo><mfrac><mrow><mi>F</mi><msub><mi>C</mi><mrow><mi>i</mi><mo>,</mo><mi>x</mi></mrow></msub></mrow><mrow><mo>max</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>F</mi><mi>C</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>x</mi></msub></mrow></mfrac><mo>⋅</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>,</mo><mi>x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
TSI_{i,x} = \frac{FC_{i,x}}{\max(FC)_x} \cdot w_{i,x}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>i</mi><mo>,</mo><mi>x</mi></mrow></msub><mo>=</mo><mtext mathvariant="normal">rescale</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><msub><mo>log</mo><mn>10</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>p</mi><mi>a</mi><mi>d</mi><msub><mi>j</mi><mrow><mi>i</mi><mo>,</mo><mi>x</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="0.222em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
w_{i,x} = \text{rescale}\left( -\log_{10}(padj_{i,x}),\ [0, 1] \right)
</annotation></semantics></math></p>
<p>where:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
is a specific cell type</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mo stretchy="false" form="prefix">{</mo><mi>r</mi><mo>,</mo><mi>g</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">x \in \{r, g\}</annotation></semantics></math>,
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>
for regulatory region (RETSI) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math>
for gene (GETSI)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mtext mathvariant="normal">FC</mtext><mrow><mi>i</mi><mo>,</mo><mi>x</mi></mrow></msub><annotation encoding="application/x-tex">\text{FC}_{i,x}</annotation></semantics></math>
is the log fold-change of feature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
in cell type
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mrow><mi>i</mi><mo>,</mo><mi>x</mi></mrow></msub><annotation encoding="application/x-tex">w_{i,x}</annotation></semantics></math>
is the weight term, defined as the rescaled value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>−</mi><msub><mo>log</mo><mn>10</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mtext mathvariant="normal">adjusted </mtext><mspace width="0.333em"></mspace></mrow><mi>p</mi><mtext mathvariant="normal">-value</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">-\log_{10}(\text{adjusted } p\text{-value})</annotation></semantics></math>
between 0 and 1</li>
</ul>
<p>Additionally, SPICEY supports the integration of regulatory elements
with their putative target genes using multiple linking strategies,
including:</p>
<ul>
<li>Nearest-gene assignment</li>
<li>Co-accessibility-based linking (when co-accessibility links are
available)</li>
</ul>
<p>These linking approaches enable SPICEY to combine regulatory
specificity (RETSI) and gene expression specificity (GETSI),
facilitating integrated analyses of gene regulatory architecture at
single-cell resolution.</p>
<p>This vignette demonstrates how to use SPICEY with preprocessed
GRanges input files. These input files must be prepared in advance (not
provided by the package).</p>
</div>
<div class="section level3">
<h3 id="entropy-based-specificity-indices">
<strong>Entropy-based specificity indices</strong><a class="anchor" aria-label="anchor" href="#entropy-based-specificity-indices"></a>
</h3>
<p>To complement fold change-based indices, SPICEY also quantifies
<strong>the distributional skewness</strong> of features using
<strong>Shannon entropy</strong>. For each regulatory region or gene,
activity or expression values across all NNN cell types are converted
into a probability distribution:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo>=</mo><mi>−</mi><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><msub><mi>p</mi><mi>i</mi></msub><msub><mo>log</mo><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
H = - \sum_{i=1}^{N} p_i \log_2(p_i)
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mrow><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi></mrow></msub><mo>=</mo><mn>1</mn><mo>−</mo><msup><mi>e</mi><mi>H</mi></msup></mrow><annotation encoding="application/x-tex">
H_{norm} = 1 - e^{H}
</annotation></semantics></math></p>
<p>where:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi><mo>,</mo><mi>x</mi></mrow></msub><mo>=</mo><mfrac><msub><mi>a</mi><mrow><mi>i</mi><mo>,</mo><mi>x</mi></mrow></msub><mrow><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><msub><mi>a</mi><mrow><mi>j</mi><mo>,</mo><mi>x</mi></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">p_{i,x} = \frac{a_{i,x}}{\sum_{j=1}^{N} a_{j,x}}</annotation></semantics></math>
is the normalized activity or expression of feature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
across
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
cell types</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mrow><mi>i</mi><mo>,</mo><mi>x</mi></mrow></msub><annotation encoding="application/x-tex">a_{i,x}</annotation></semantics></math>
is the activity (for RETSI) or expression (for GETSI) value in cell type
$$</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mi>x</mi></msub><annotation encoding="application/x-tex">H_x</annotation></semantics></math>
is the Shannon entropy, and Normalized Entropy ranges between 0 (cell
type specific) and 1 (cell type shared).</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install the development version from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"georginafp/SPICEY"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="input-requirements">Input Requirements<a class="anchor" aria-label="anchor" href="#input-requirements"></a>
</h2>
<p>SPICEY requires carefully prepared input files representing processed
single-cell omics data, specifically from differential analyses of
chromatin accessibility (ATAC-seq) and/or gene expression (RNA-seq).
These inputs are <strong>not provided</strong> within the package and
must be generated externally beforehand. Below is a detailed description
of each required input and the necessary metadata.</p>
<div class="section level3">
<h3 id="single-cell-atac-seq-data">1. Single cell ATAC-seq data<a class="anchor" aria-label="anchor" href="#single-cell-atac-seq-data"></a>
</h3>
<ul>
<li><p><strong>Format:</strong> <code>GRanges</code> or
<code>data.frame</code> convertible to <code>GRanges</code></p></li>
<li>
<p><strong>Required columns:</strong></p>
<ul>
<li><p><code>seqnames</code>, <code>start</code>, <code>end</code> —
genomic coordinates of the peak.</p></li>
<li><p><code>avg_log2FC</code> — average log2 fold-change of chromatin
accessibility for the peak in a specific cell type (output from
differential accessibility analysis).</p></li>
<li><p><code>p_val</code> — raw or adjusted p-value corresponding to the
differential accessibility test for the peak (output from differential
accessibility analysis).</p></li>
<li><p><code>cell_type</code> — cell type or cluster label associated
with each differential measurement.</p></li>
</ul>
</li>
</ul>
<p>The <strong>ATAC peaks input</strong> must include <strong>multiple
rows per peak</strong> representing differential statistics for each
cell type. For example, the same peak may appear with different
<code>avg_log2FC</code>, <code>p_val</code>, and <code>cell_type</code>
values reflecting its differential accessibility in each cell type.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"atac"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="single-cell-rna-seq-data">2. Single cell RNA-seq data<a class="anchor" aria-label="anchor" href="#single-cell-rna-seq-data"></a>
</h3>
<ul>
<li><p><strong>Format:</strong> <code>GRanges</code> or
<code>data.frame</code> convertible to <code>GRanges</code></p></li>
<li>
<p><strong>Required columns:</strong></p>
<ul>
<li><p><code>symbol</code> — identifier of the gene.</p></li>
<li><p><code>avg_log2FC</code> — average log2 fold-change of chromatin
accessibility for the peak in a specific cell type (output from
differential accessibility analysis).</p></li>
<li><p><code>p_val</code> — raw or adjusted p-value corresponding to the
differential accessibility test for the peak (output from differential
accessibility analysis).</p></li>
<li><p><code>cell_type</code> — cell type or cluster label associated
with each differential measurement.</p></li>
</ul>
</li>
</ul>
<p>The RNA input must represent differential expression results, i.e.,
statistics computed for each gene across cell types.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"rna"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="co-accessibility-links-optional-for-region-to-gene-linking-mode">3. Co-accessibility Links (optional, for region-to-gene linking
mode)<a class="anchor" aria-label="anchor" href="#co-accessibility-links-optional-for-region-to-gene-linking-mode"></a>
</h3>
<ul>
<li><p><strong>Purpose:</strong> To link regulatory elements based on
co-accessibility inferred from tools like Signac’s
<code>LinkPeaks()</code>. This supports integrative analysis of
regulatory elements and gene expression.</p></li>
<li>
<p><strong>Format:</strong></p>
<ul>
<li>Either a <code>GInteractions</code> or a <code>GRangesList</code>
object with metadata columns.</li>
</ul>
</li>
</ul>
<!-- --><ul>
<li>
<p><strong>Required columns:</strong></p>
<ul>
<li><p><code>Peaks1</code> — genomic coordinate or ID of the first peak
in the pair.</p></li>
<li><p><code>Peaks2</code> — genomic coordinate or ID of the second peak
linked by co-accessibility.</p></li>
<li><p><code>coaccess</code> — co-accessibility score or correlation
value.</p></li>
<li><p><code>CCAN1</code>, <code>CCAN2</code> — CCAN (co-accessibility
network) identifiers for the peaks.</p></li>
</ul>
</li>
</ul>
<p>The peaks referenced here <strong>must match</strong> exactly those
in the ATAC peaks input (same coordinates or peak IDs).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"cicero_links"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cicero_links</span><span class="op">)</span></span>
<span><span class="co">#&gt;                       Peak1                     Peak2     coaccess</span></span>
<span><span class="co">#&gt; 1      chr2-5506813-5507737      chr2-5693250-5693911  0.093227933</span></span>
<span><span class="co">#&gt; 2  chr3-111728040-111728766  chr3-111836220-111836612 -0.000154212</span></span>
<span><span class="co">#&gt; 3    chr3-54281710-54282000    chr3-54014148-54014347  0.000000000</span></span>
<span><span class="co">#&gt; 4 chr11-128734460-128734775 chr11-128298619-128299732 -0.002326294</span></span>
<span><span class="co">#&gt; 5   chr13-93284776-93284975   chr13-93397849-93398575  0.039018033</span></span>
<span><span class="co">#&gt; 6    chr8-79879783-79881132    chr8-80122041-80123202 -0.018005821</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="example-run-spicey-step-by-step">Example: Run SPICEY step-by-step<a class="anchor" aria-label="anchor" href="#example-run-spicey-step-by-step"></a>
</h2>
<p>This section demonstrates how to run SPICEY using prepared input
files, as described in earlier sections.</p>
<div class="section level3">
<h3 id="computing-retsi">Computing RETSI<a class="anchor" aria-label="anchor" href="#computing-retsi"></a>
</h3>
<p>To calculate the <strong>Regulatory Element Tissue Specificity Index
(RETSI)</strong>, the following input is required:</p>
<ul>
<li>
<p><strong><code>atac</code></strong> : A <code>GRanges</code>
object or data frame convertible to <code>GRanges</code> containing
differential accessibility results from scATAC-seq data. Required
columns:</p>
<ul>
<li><p><code>seqnames</code>, <code>start</code>, <code>end</code>:
Genomic coordinates of peaks</p></li>
<li><p><code>avg_log2FC</code>: Average log2 fold-change of
accessibility for each peak</p></li>
<li><p><code>p_val</code>: Raw or adjusted p-value from differential
accessibility tests</p></li>
<li><p><code>cell_type</code>: Cell type or cluster label</p></li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">retsi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spicey_retsi.html">spicey_retsi</a></span><span class="op">(</span><span class="va">atac</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">retsi</span><span class="op">)</span></span>
<span><span class="co">#&gt;   seqnames     start       end width strand cell_type     p_val_adj p_val</span></span>
<span><span class="co">#&gt; 1     chr7 142748901 142749963  1063      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 2    chr14  66378630  66379738  1109      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 3    chr22  27241597  27243500  1904      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 4    chr17  82909239  82910392  1154      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 5     chr2  79119834  79120951  1118      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 6    chr10 116587488 116588562  1075      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt;   avg_log2FC                    region RETSI norm_entropy</span></span>
<span><span class="co">#&gt; 1   6.025791  chr7:142748901-142749963     1  0.065607360</span></span>
<span><span class="co">#&gt; 2   5.742438   chr14:66378630-66379738     1  0.198069323</span></span>
<span><span class="co">#&gt; 3   6.111680   chr22:27241597-27243500     1  0.007724027</span></span>
<span><span class="co">#&gt; 4   6.066587   chr17:82909239-82910392     1  0.018789741</span></span>
<span><span class="co">#&gt; 5   6.160286    chr2:79119834-79120951     1  0.011755466</span></span>
<span><span class="co">#&gt; 6   6.299025 chr10:116587488-116588562     1  0.002236650</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="computing-getsi">Computing GETSI<a class="anchor" aria-label="anchor" href="#computing-getsi"></a>
</h3>
<p>To calculate the <strong>Gene Expression Tissue Specificity Index
(GETSI)</strong>, the required input is:</p>
<ul>
<li>
<p><strong><code>rna</code></strong>: A <code>GRanges</code> object
or data frame convertible to <code>GRanges</code> containing
differential expression results from scRNA-seq data. Required columns
are similar to those for <code>atac</code> but relevant for gene
expression.</p>
<ul>
<li><p><code>symbol</code> — identifier of the gene.</p></li>
<li><p><code>avg_log2FC</code>: Average log2 fold-change of
accessibility for each peak</p></li>
<li><p><code>p_val</code>: Raw or adjusted p-value from differential
accessibility tests</p></li>
<li><p><code>cell_type</code>: Cell type or cluster label</p></li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">getsi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spicey_getsi.html">spicey_getsi</a></span><span class="op">(</span><span class="va">rna</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">getsi</span><span class="op">)</span></span>
<span><span class="co">#&gt;   gene_id         p_val avg_log2FC pct.1 pct.2     p_val_adj cell_type</span></span>
<span><span class="co">#&gt; 1   REG1A  0.000000e+00   6.446878 0.392 0.012 6.967263e-216    Acinar</span></span>
<span><span class="co">#&gt; 2   PRSS1 3.793351e-218   5.111544 0.608 0.067 6.967263e-216    Acinar</span></span>
<span><span class="co">#&gt; 3   PNLIP 5.687535e-208   5.156786 0.471 0.038 9.660474e-206    Acinar</span></span>
<span><span class="co">#&gt; 4 ANKRD62 8.944741e-189   5.186987 0.529 0.056 1.320605e-186    Acinar</span></span>
<span><span class="co">#&gt; 5   PRSS2 1.241892e-185   4.545974 0.568 0.066 1.799054e-183    Acinar</span></span>
<span><span class="co">#&gt; 6   PTF1A 3.711279e-176   5.042912 0.379 0.028 5.000185e-174    Acinar</span></span>
<span><span class="co">#&gt;       GETSI norm_entropy</span></span>
<span><span class="co">#&gt; 1 1.0000000  0.004473985</span></span>
<span><span class="co">#&gt; 2 1.0000000  0.095847822</span></span>
<span><span class="co">#&gt; 3 0.9528626  0.013732911</span></span>
<span><span class="co">#&gt; 4 0.8639239  0.024782578</span></span>
<span><span class="co">#&gt; 5 0.8493565  0.376959946</span></span>
<span><span class="co">#&gt; 6 0.8054632  0.011539343</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="annotating-regulatory-elements-to-target-genes">Annotating Regulatory Elements to Target Genes<a class="anchor" aria-label="anchor" href="#annotating-regulatory-elements-to-target-genes"></a>
</h3>
<p>SPICEY allows you to annotate regulatory elements to their putative
target genes using one of two methods:</p>
<div class="section level5">
<h5 id="nearest-gene-annotation">1. Nearest Gene Annotation<a class="anchor" aria-label="anchor" href="#nearest-gene-annotation"></a>
</h5>
<p>This mode links each regulatory region to its nearest gene TSS.</p>
<p><strong>Required inputs:</strong></p>
<ul>
<li><p><code>retsi</code>: Output from <code><a href="../reference/spicey_retsi.html">spicey_retsi()</a></code>,
containing RETSI values</p></li>
<li><p><code>annot_method</code>: Set to <code>"nearest"</code></p></li>
<li><p><code>txdb</code>: A <code>TxDb</code> object with gene
models</p></li>
<li><p><code>annot_dbi</code>: AnnotationDbi object (e.g.,
<code>org.Hs.eg.db</code>) to add gene metadata</p></li>
</ul>
<p><strong>Optional parameters:</strong></p>
<ul>
<li><p><code>filter_promoter_distal</code>: Exclude promoter-proximal
regions (default: <code>TRUE</code>)</p></li>
<li><p><code>filter_protein_coding</code>: Limit to protein-coding genes
(default: <code>TRUE</code>)</p></li>
<li><p><code>keep_mito</code>: Retain mitochondrial peaks (default:
<code>FALSE</code>)</p></li>
<li><p><code>add_tss_annotation</code>: Include TSS distance and related
columns (default: <code>FALSE</code>)</p></li>
<li><p><code>link_spicey_measures</code>: Join RETSI and GETSI scores by
gene (default: <code>FALSE</code>)</p></li>
<li><p><code>verbose</code>: Display progress (default:
<code>TRUE</code>)</p></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">retsi_gene_nearest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/annotate_with_nearest.html">annotate_with_nearest</a></span><span class="op">(</span></span>
<span>  retsi <span class="op">=</span> <span class="va">retsi</span>,</span>
<span>  txdb <span class="op">=</span> <span class="fu">TxDb.Hsapiens.UCSC.hg38.knownGene</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/TxDb.Hsapiens.UCSC.hg38.knownGene/man/package.html" class="external-link">TxDb.Hsapiens.UCSC.hg38.knownGene</a></span>, </span>
<span>  annot_dbi <span class="op">=</span> <span class="fu">org.Hs.eg.db</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/org.Hs.eg.db/man/org.Hs.egBASE.html" class="external-link">org.Hs.eg.db</a></span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">retsi_gene_nearest</span><span class="op">)</span></span>
<span><span class="co">#&gt;   seqnames     start       end width strand cell_type     p_val_adj p_val</span></span>
<span><span class="co">#&gt; 1     chr7 142748901 142749963  1063      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 2    chr14  66378630  66379738  1109      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 3    chr22  27241597  27243500  1904      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 4    chr17  82909239  82910392  1154      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 5     chr2  79119834  79120951  1118      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 6    chr10 116587488 116588562  1075      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt;   avg_log2FC                    region RETSI norm_entropy distanceToTSS</span></span>
<span><span class="co">#&gt; 1   6.025791  chr7:142748901-142749963     1  0.065607360             0</span></span>
<span><span class="co">#&gt; 2   5.742438   chr14:66378630-66379738     1  0.198069323         29965</span></span>
<span><span class="co">#&gt; 3   6.111680   chr22:27241597-27243500     1  0.007724027        546383</span></span>
<span><span class="co">#&gt; 4   6.066587   chr17:82909239-82910392     1  0.018789741             0</span></span>
<span><span class="co">#&gt; 5   6.160286    chr2:79119834-79120951     1  0.011755466             0</span></span>
<span><span class="co">#&gt; 6   6.299025 chr10:116587488-116588562     1  0.002236650             0</span></span>
<span><span class="co">#&gt;   nearestGeneSymbol annotation</span></span>
<span><span class="co">#&gt; 1             PRSS1   Promoter</span></span>
<span><span class="co">#&gt; 2           CCDC196     Distal</span></span>
<span><span class="co">#&gt; 3               MN1     Distal</span></span>
<span><span class="co">#&gt; 4              TBCD   Promoter</span></span>
<span><span class="co">#&gt; 5             REG1A   Promoter</span></span>
<span><span class="co">#&gt; 6          PNLIPRP1   Promoter</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="co-accessibility-based-annotation">2. Co-accessibility-Based Annotation<a class="anchor" aria-label="anchor" href="#co-accessibility-based-annotation"></a>
</h5>
<p>This mode links regulatory regions to genes via co-accessibility
interactions, which must be computed externally (e.g., using
<strong>Cicero</strong> or <strong>Signac</strong>).</p>
<p><strong>Required inputs:</strong></p>
<ul>
<li><p><code>retsi</code>: Output from <code><a href="../reference/spicey_retsi.html">spicey_retsi()</a></code>,
containing RETSI values</p></li>
<li><p><code>annot_method</code>: Set to
<code>"coaccessibility"</code></p></li>
<li><p><code>links</code>: A <code>data.frame</code>,
<code>GRangesList</code>, or Cicero/ArchR-style object with
co-accessibility links</p></li>
<li><p><code>coaccess_cutoff_override</code>: Minimum co-accessibility
score (default: <code>0.25</code>)</p></li>
</ul>
<p><strong>Optional parameters:</strong></p>
<ul>
<li><p><code>filter_promoter_distal</code>: Exclude promoter-proximal
regions (default: <code>TRUE</code>)</p></li>
<li><p><code>filter_protein_coding</code>: Limit to protein-coding genes
(default: <code>TRUE</code>)</p></li>
<li><p><code>keep_mito</code>: Retain mitochondrial peaks (default:
<code>FALSE</code>)</p></li>
<li><p><code>add_tss_annotation</code>: Include TSS distance and related
columns (default: <code>FALSE</code>)</p></li>
<li><p><code>link_spicey_measures</code>: Join RETSI and GETSI scores by
gene (default: <code>FALSE</code>)</p></li>
<li><p><code>verbose</code>: Display progress (default:
<code>TRUE</code>)</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Filter links for high coaccessibility score</span></span>
<span><span class="va">coacc_links</span> <span class="op">&lt;-</span> <span class="va">cicero_links</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">coaccess</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">retsi_gene_coacc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/annotate_with_coaccessibility.html">annotate_with_coaccessibility</a></span><span class="op">(</span></span>
<span>  links <span class="op">=</span> <span class="va">coacc_links</span>,</span>
<span>  retsi <span class="op">=</span> <span class="va">retsi</span>,</span>
<span>  txdb <span class="op">=</span> <span class="fu">TxDb.Hsapiens.UCSC.hg38.knownGene</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/TxDb.Hsapiens.UCSC.hg38.knownGene/man/package.html" class="external-link">TxDb.Hsapiens.UCSC.hg38.knownGene</a></span>, </span>
<span>  annot_dbi <span class="op">=</span> <span class="fu">org.Hs.eg.db</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/org.Hs.eg.db/man/org.Hs.egBASE.html" class="external-link">org.Hs.eg.db</a></span>,</span>
<span>  coaccess_cutoff_override <span class="op">=</span> <span class="fl">0.25</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Coaccessibility cutoff used: 0.25"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">retsi_gene_coacc</span><span class="op">)</span></span>
<span><span class="co">#&gt;   seqnames     start       end width strand cell_type     p_val_adj p_val</span></span>
<span><span class="co">#&gt; 1     chr7 142748901 142749963  1063      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 2    chr14  66378630  66379738  1109      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 3    chr22  27241597  27243500  1904      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 4    chr17  82909239  82910392  1154      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 5     chr2  79119834  79120951  1118      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 6    chr10 116587488 116588562  1075      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt;   avg_log2FC                    region RETSI norm_entropy distanceToTSS</span></span>
<span><span class="co">#&gt; 1   6.025791  chr7:142748901-142749963     1  0.065607360             0</span></span>
<span><span class="co">#&gt; 2   5.742438   chr14:66378630-66379738     1  0.198069323         29965</span></span>
<span><span class="co">#&gt; 3   6.111680   chr22:27241597-27243500     1  0.007724027        546383</span></span>
<span><span class="co">#&gt; 4   6.066587   chr17:82909239-82910392     1  0.018789741             0</span></span>
<span><span class="co">#&gt; 5   6.160286    chr2:79119834-79120951     1  0.011755466             0</span></span>
<span><span class="co">#&gt; 6   6.299025 chr10:116587488-116588562     1  0.002236650             0</span></span>
<span><span class="co">#&gt;   annotation gene_coacc in_TSS TSS_gene</span></span>
<span><span class="co">#&gt; 1   Promoter         NA  FALSE     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2     Distal         NA  FALSE     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3     Distal         NA  FALSE     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4   Promoter         NA  FALSE     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5   Promoter         NA   TRUE    REG1A</span></span>
<span><span class="co">#&gt; 6   Promoter         NA  FALSE     &lt;NA&gt;</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="linking-retsi-and-getsi-scores-to-build-tissue-specific-regulatory-networks">Linking RETSI and GETSI Scores to Build Tissue-Specific Regulatory
Networks<a class="anchor" aria-label="anchor" href="#linking-retsi-and-getsi-scores-to-build-tissue-specific-regulatory-networks"></a>
</h3>
<p>To construct an integrated regulatory network that links RETSI and
GETSI scores, SPICEY allows you to associate both scores at the gene
level using either annotation strategy:</p>
<div class="section level5">
<h5 id="if-using-nearest-gene-annotation">If using <strong>nearest-gene</strong> annotation:<a class="anchor" aria-label="anchor" href="#if-using-nearest-gene-annotation"></a>
</h5>
<ul>
<li><p><code>retsi_gene_nearest</code>: Output from
<code><a href="../reference/annotate_with_nearest.html">annotate_with_nearest()</a></code>, linking peaks to nearest genes
with RETSI scores</p></li>
<li><p><code>getsi</code>: Output from <code><a href="../reference/spicey_getsi.html">spicey_getsi()</a></code>,
providing GETSI scores for genes</p></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spicey_nearest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/link_spicey_nearest.html">link_spicey_nearest</a></span><span class="op">(</span><span class="va">retsi_gene_nearest</span>, <span class="va">getsi</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spicey_nearest</span><span class="op">)</span></span>
<span><span class="co">#&gt;   seqnames     start       end width strand cell_type     p_val_adj p_val</span></span>
<span><span class="co">#&gt; 1     chr7 142748901 142749963  1063      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 2    chr22  27241597  27243500  1904      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 3    chr17  82909239  82910392  1154      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 4     chr2  79119834  79120951  1118      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 5    chr10 116587488 116588562  1075      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 6    chr10 116553223 116553959   737      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt;   avg_log2FC                    region RETSI RETSI_entropy distanceToTSS</span></span>
<span><span class="co">#&gt; 1   6.025791  chr7:142748901-142749963     1   0.065607360             0</span></span>
<span><span class="co">#&gt; 2   6.111680   chr22:27241597-27243500     1   0.007724027        546383</span></span>
<span><span class="co">#&gt; 3   6.066587   chr17:82909239-82910392     1   0.018789741             0</span></span>
<span><span class="co">#&gt; 4   6.160286    chr2:79119834-79120951     1   0.011755466             0</span></span>
<span><span class="co">#&gt; 5   6.299025 chr10:116587488-116588562     1   0.002236650             0</span></span>
<span><span class="co">#&gt; 6   6.849885 chr10:116553223-116553959     1   0.001301460          5130</span></span>
<span><span class="co">#&gt;   gene_nearest annotation        GETSI GETSI_entropy</span></span>
<span><span class="co">#&gt; 1        PRSS1   Promoter 1.0000000000   0.095847822</span></span>
<span><span class="co">#&gt; 2          MN1     Distal 0.0001055331   0.681930617</span></span>
<span><span class="co">#&gt; 3         TBCD   Promoter 0.0060596138   0.491472040</span></span>
<span><span class="co">#&gt; 4        REG1A   Promoter 1.0000000000   0.004473985</span></span>
<span><span class="co">#&gt; 5     PNLIPRP1   Promoter 0.7329113167   0.017352521</span></span>
<span><span class="co">#&gt; 6        PNLIP     Distal 0.9528625893   0.013732911</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="if-using-co-accessibility-annotation">If using <strong>co-accessibility</strong> annotation:<a class="anchor" aria-label="anchor" href="#if-using-co-accessibility-annotation"></a>
</h4>
<ul>
<li><p><code>retsi_gene_coacc</code>: Output from
<code><a href="../reference/annotate_with_coaccessibility.html">annotate_with_coaccessibility()</a></code>, linking peaks to
co-accessible genes with RETSI scores</p></li>
<li><p><code>getsi</code>: Output from <code><a href="../reference/spicey_getsi.html">spicey_getsi()</a></code>,
providing GETSI scores for genes</p></li>
</ul>
<p>By integrating RETSI and GETSI, SPICEY enables comprehensive analysis
of tissue-specific regulatory logic at both the epigenetic and
transcriptional levels.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spicey_coacc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/link_spicey_coaccessible.html">link_spicey_coaccessible</a></span><span class="op">(</span><span class="va">retsi_gene_coacc</span>, <span class="va">getsi</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spicey_coacc</span><span class="op">)</span></span>
<span><span class="co">#&gt;   seqnames start end width strand cell_type p_val_adj p_val avg_log2FC region</span></span>
<span><span class="co">#&gt; 1     &lt;NA&gt;    NA  NA    NA   &lt;NA&gt;    Acinar        NA    NA         NA   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2     &lt;NA&gt;    NA  NA    NA   &lt;NA&gt;    Acinar        NA    NA         NA   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3     &lt;NA&gt;    NA  NA    NA   &lt;NA&gt;    Acinar        NA    NA         NA   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4     &lt;NA&gt;    NA  NA    NA   &lt;NA&gt;    Acinar        NA    NA         NA   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5     &lt;NA&gt;    NA  NA    NA   &lt;NA&gt;    Acinar        NA    NA         NA   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6     &lt;NA&gt;    NA  NA    NA   &lt;NA&gt;    Acinar        NA    NA         NA   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;   RETSI RETSI_entropy distanceToTSS annotation gene_coacc in_TSS TSS_gene</span></span>
<span><span class="co">#&gt; 1    NA            NA            NA       &lt;NA&gt;      REG1A     NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2    NA            NA            NA       &lt;NA&gt;      PRSS1     NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3    NA            NA            NA       &lt;NA&gt;      PNLIP     NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4    NA            NA            NA       &lt;NA&gt;    ANKRD62     NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5    NA            NA            NA       &lt;NA&gt;      PRSS2     NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6    NA            NA            NA       &lt;NA&gt;      PTF1A     NA     &lt;NA&gt;</span></span>
<span><span class="co">#&gt;       GETSI GETSI_entropy</span></span>
<span><span class="co">#&gt; 1 1.0000000   0.004473985</span></span>
<span><span class="co">#&gt; 2 1.0000000   0.095847822</span></span>
<span><span class="co">#&gt; 3 0.9528626   0.013732911</span></span>
<span><span class="co">#&gt; 4 0.8639239   0.024782578</span></span>
<span><span class="co">#&gt; 5 0.8493565   0.376959946</span></span>
<span><span class="co">#&gt; 6 0.8054632   0.011539343</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="example-run-spicey-whole-pipeline">Example: Run SPICEY whole pipeline<a class="anchor" aria-label="anchor" href="#example-run-spicey-whole-pipeline"></a>
</h2>
<p>While SPICEY provides modular functions—such as
<code><a href="../reference/spicey_retsi.html">spicey_retsi()</a></code>, <code><a href="../reference/spicey_getsi.html">spicey_getsi()</a></code>, and
<code><a href="../reference/annotate_with_nearest.html">annotate_with_nearest()</a></code>—for users who prefer fine-grained
control, it also includes a wrapper function, <code><a href="../reference/run_spicey.html">run_spicey()</a></code>,
that streamlines the full workflow into a single, reproducible step.</p>
<p>This wrapper automatically determines which operations to perform
based on the input data and parameters provided, making it ideal for
users seeking a quick, end-to-end analysis without manually managing
each intermediate step.</p>
<p>When supplied with differential accessibility (ATAC) and/or gene
expression (RNA) data, and a gene-linking strategy (“nearest” or
“coaccessibility”), <code><a href="../reference/run_spicey.html">run_spicey()</a></code> performs the following
operations as needed:</p>
<ul>
<li><p><strong>RETSI computation</strong> (if ATAC data is
provided)</p></li>
<li><p><strong>GETSI computation</strong> (if RNA data is
provided)</p></li>
<li>
<p><strong>Annotation of regulatory regions to target
genes</strong>, via:</p>
<ul>
<li><p><code>"nearest"</code> gene TSS or</p></li>
<li><p><code>"coaccessibility"</code> links (e.g., from Cicero or
ArchR)</p></li>
</ul>
</li>
</ul>
<p><strong>Linking RETSI and GETSI scores by gene</strong> (if
<code>link_spicey_measures = TRUE</code>)</p>
<p>The function returns a structured list containing all intermediate
and final outputs, making it easy to inspect and reuse individual
components of the pipeline.</p>
<p>For users who prefer to run each step independently—for example, to
apply custom filters or transformations—each module remains fully
accessible and can be run separately.</p>
<div class="section level4">
<h4 id="overview-run_spicey">Overview: <code>run_spicey()</code><a class="anchor" aria-label="anchor" href="#overview-run_spicey"></a>
</h4>
<p>Depending on the inputs provided, <code><a href="../reference/run_spicey.html">run_spicey()</a></code>
performs:</p>
<ul>
<li>
<strong>RETSI calculation</strong> – from differential accessibility
data (ATAC-seq)</li>
</ul>
<!-- --><ul>
<li><p><strong>GETSI calculation</strong> – from differential expression
data (RNA-seq)</p></li>
<li>
<p><strong>Annotation</strong> of regulatory regions to genes
(optional):</p>
<ul>
<li><p><code>"nearest"</code>: Assign to closest gene</p></li>
<li><p><code>"coaccessibility"</code>: Use user-supplied
co-accessibility links</p></li>
</ul>
</li>
<li><p><strong>Linking</strong> RETSI and GETSI scores by gene
(optional)</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a>
</h4>
<ul>
<li>
<p><code>atac</code>: A <code>GRanges</code> object or data frame
convertible to <code>GRanges</code>, containing scATAC-seq differential
accessibility results. Required columns:</p>
<ul>
<li><p><code>seqnames</code>, <code>start</code>, <code>end</code>:
Genomic coordinates</p></li>
<li><p><code>avg_log2FC</code>: Average log2 fold-change in
accessibility</p></li>
<li><p><code>p_val</code>: Raw or adjusted p-value from DA
analysis</p></li>
<li><p><code>cell_type</code>: Cell type or cluster label</p></li>
</ul>
</li>
<li>
<p><code>rna</code>: A <code>GRanges</code> object or data frame
convertible to <code>GRanges</code>, containing scRNA-seq differential
expression results. Same structure as <code>atac</code>:</p>
<ul>
<li><p><code>symbol</code> — identifier of the gene.</p></li>
<li><p><code>avg_log2FC</code>: Average log2 fold-change in
accessibility</p></li>
<li><p><code>p_val</code>: Raw or adjusted p-value from DA
analysis</p></li>
<li><p><code>cell_type</code>: Cell type or cluster label</p></li>
</ul>
</li>
<li><p><code>annot_method</code>: One of <code>"nearest"</code>
(default) or <code>"coaccessibility"</code>, indicating the method to
link peaks to genes.</p></li>
<li><p><code>links</code>: Required if
<code>annot_method = "coaccessibility"</code>. A
<code>data.frame</code>, <code>GRangesList</code>, or Cicero/ArchR-style
object with co-accessibility links (peak-pairs and scores).</p></li>
<li><p><code>coaccess_cutoff_override</code>: <em>(default = 0.25)</em>
Minimum co-accessibility score to retain a link.</p></li>
<li><p><code>filter_promoter_distal</code>: <em>(default = TRUE)</em>
Whether to exclude promoter-proximal interactions when using
co-accessibility.</p></li>
<li><p><code>filter_protein_coding</code>: <em>(default = TRUE)</em>
Whether to restrict gene annotations to protein-coding genes.</p></li>
<li>
<p><code>txdb</code>: A <code>TxDb</code> object with gene models
used for annotation.</p>
<p><code>annot_dbi</code>: An <code>AnnotationDbi</code> object (e.g.,
<code>org.Hs.eg.db</code>) for adding gene symbols or additional
metadata.</p>
</li>
<li><p><code>keep_mito</code>: <em>(default = FALSE)</em> Whether to
retain mitochondrial peaks.</p></li>
<li><p><code>add_tss_annotation</code>: <em>(default = FALSE)</em>
Whether to include TSS-related metadata (e.g., distance to TSS) in the
output.</p></li>
<li><p><code>link_spicey_measures</code>: <em>(default = FALSE)</em>
Whether to merge RETSI and GETSI scores by gene after
annotation.</p></li>
<li><p><code>verbose</code>: <em>(default = TRUE)</em> Whether to
display progress messages during execution.</p></li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">spicey_nearest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_spicey.html">run_spicey</a></span><span class="op">(</span></span>
<span>  atac <span class="op">=</span> <span class="va">atac</span>, </span>
<span>  rna <span class="op">=</span> <span class="va">rna</span>, </span>
<span>  annot_method <span class="op">=</span> <span class="st">"nearest"</span>, </span>
<span>  txdb <span class="op">=</span> <span class="fu">TxDb.Hsapiens.UCSC.hg38.knownGene</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/TxDb.Hsapiens.UCSC.hg38.knownGene/man/package.html" class="external-link">TxDb.Hsapiens.UCSC.hg38.knownGene</a></span>, </span>
<span>  annot_dbi <span class="op">=</span> <span class="fu">org.Hs.eg.db</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/org.Hs.eg.db/man/org.Hs.egBASE.html" class="external-link">org.Hs.eg.db</a></span>,</span>
<span>  link_spicey_measures <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spicey_nearest</span><span class="op">)</span></span>
<span><span class="co">#&gt;   seqnames     start       end width strand cell_type     p_val_adj p_val</span></span>
<span><span class="co">#&gt; 1     chr7 142748901 142749963  1063      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 2    chr22  27241597  27243500  1904      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 3    chr17  82909239  82910392  1154      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 4     chr2  79119834  79120951  1118      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 5    chr10 116587488 116588562  1075      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt; 6    chr10 116553223 116553959   737      *    Acinar 1.158316e-300     0</span></span>
<span><span class="co">#&gt;   avg_log2FC                    region RETSI RETSI_entropy distanceToTSS</span></span>
<span><span class="co">#&gt; 1   6.025791  chr7:142748901-142749963     1   0.065607360             0</span></span>
<span><span class="co">#&gt; 2   6.111680   chr22:27241597-27243500     1   0.007724027        546383</span></span>
<span><span class="co">#&gt; 3   6.066587   chr17:82909239-82910392     1   0.018789741             0</span></span>
<span><span class="co">#&gt; 4   6.160286    chr2:79119834-79120951     1   0.011755466             0</span></span>
<span><span class="co">#&gt; 5   6.299025 chr10:116587488-116588562     1   0.002236650             0</span></span>
<span><span class="co">#&gt; 6   6.849885 chr10:116553223-116553959     1   0.001301460          5130</span></span>
<span><span class="co">#&gt;   gene_nearest annotation        GETSI GETSI_entropy</span></span>
<span><span class="co">#&gt; 1        PRSS1   Promoter 1.0000000000   0.095847822</span></span>
<span><span class="co">#&gt; 2          MN1     Distal 0.0001055331   0.681930617</span></span>
<span><span class="co">#&gt; 3         TBCD   Promoter 0.0060596138   0.491472040</span></span>
<span><span class="co">#&gt; 4        REG1A   Promoter 1.0000000000   0.004473985</span></span>
<span><span class="co">#&gt; 5     PNLIPRP1   Promoter 0.7329113167   0.017352521</span></span>
<span><span class="co">#&gt; 6        PNLIP     Distal 0.9528625893   0.013732911</span></span>
<span></span>
<span><span class="va">spicey_coacc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_spicey.html">run_spicey</a></span><span class="op">(</span></span>
<span>  atac <span class="op">=</span> <span class="va">atac</span>,</span>
<span>  rna <span class="op">=</span> <span class="va">rna</span>,</span>
<span>  annot_method <span class="op">=</span> <span class="st">"coaccessibility"</span>,</span>
<span>  links <span class="op">=</span> <span class="va">coacc_links</span>,</span>
<span>  txdb <span class="op">=</span> <span class="fu">TxDb.Hsapiens.UCSC.hg38.knownGene</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/TxDb.Hsapiens.UCSC.hg38.knownGene/man/package.html" class="external-link">TxDb.Hsapiens.UCSC.hg38.knownGene</a></span>, </span>
<span>  annot_dbi <span class="op">=</span> <span class="fu">org.Hs.eg.db</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/org.Hs.eg.db/man/org.Hs.egBASE.html" class="external-link">org.Hs.eg.db</a></span>,</span>
<span>  coaccess_cutoff_override <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>  link_spicey_measures <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Coaccessibility cutoff used: 0.25"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spicey_coacc</span><span class="op">)</span></span>
<span><span class="co">#&gt;   seqnames start end width strand cell_type p_val_adj p_val avg_log2FC region</span></span>
<span><span class="co">#&gt; 1     &lt;NA&gt;    NA  NA    NA   &lt;NA&gt;    Acinar        NA    NA         NA   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2     &lt;NA&gt;    NA  NA    NA   &lt;NA&gt;    Acinar        NA    NA         NA   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3     &lt;NA&gt;    NA  NA    NA   &lt;NA&gt;    Acinar        NA    NA         NA   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4     &lt;NA&gt;    NA  NA    NA   &lt;NA&gt;    Acinar        NA    NA         NA   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5     &lt;NA&gt;    NA  NA    NA   &lt;NA&gt;    Acinar        NA    NA         NA   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6     &lt;NA&gt;    NA  NA    NA   &lt;NA&gt;    Acinar        NA    NA         NA   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;   RETSI RETSI_entropy distanceToTSS annotation gene_coacc     GETSI</span></span>
<span><span class="co">#&gt; 1    NA            NA            NA       &lt;NA&gt;      REG1A 1.0000000</span></span>
<span><span class="co">#&gt; 2    NA            NA            NA       &lt;NA&gt;      PRSS1 1.0000000</span></span>
<span><span class="co">#&gt; 3    NA            NA            NA       &lt;NA&gt;      PNLIP 0.9528626</span></span>
<span><span class="co">#&gt; 4    NA            NA            NA       &lt;NA&gt;    ANKRD62 0.8639239</span></span>
<span><span class="co">#&gt; 5    NA            NA            NA       &lt;NA&gt;      PRSS2 0.8493565</span></span>
<span><span class="co">#&gt; 6    NA            NA            NA       &lt;NA&gt;      PTF1A 0.8054632</span></span>
<span><span class="co">#&gt;   GETSI_entropy</span></span>
<span><span class="co">#&gt; 1   0.004473985</span></span>
<span><span class="co">#&gt; 2   0.095847822</span></span>
<span><span class="co">#&gt; 3   0.013732911</span></span>
<span><span class="co">#&gt; 4   0.024782578</span></span>
<span><span class="co">#&gt; 5   0.376959946</span></span>
<span><span class="co">#&gt; 6   0.011539343</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h2>
<p>The following output is a <code>data frame</code> object containing
<strong>genomic regions</strong>, each representing a regulatory element
(e.g., enhancer or promoter) annotated with multiple metadata columns.
These columns provide statistical, biological, and functional
information derived from chromatin accessibility and gene expression
data.</p>
<div class="section level4">
<h4 id="metadata-columns-description">Metadata Columns Description<a class="anchor" aria-label="anchor" href="#metadata-columns-description"></a>
</h4>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Column</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>seqnames</code></td>
<td>Chromosome name (e.g., <code>chr7</code>, <code>chr17</code>) where
the region is located.</td>
</tr>
<tr class="even">
<td><code>ranges</code></td>
<td>Genomic coordinates (start–end) of the regulatory region.</td>
</tr>
<tr class="odd">
<td><code>strand</code></td>
<td>Strand information (<code>*</code> means unstranded, typical for
regulatory elements).</td>
</tr>
<tr class="even">
<td><code>width</code></td>
<td>Length of the genomic region in base pairs.</td>
</tr>
<tr class="odd">
<td><code>cell_type</code></td>
<td>The specific cell type where the region shows significant
accessibility (e.g., <code>"Acinar"</code>).</td>
</tr>
<tr class="even">
<td><code>p_val_adj</code></td>
<td>Adjusted p-value from differential accessibility testing (multiple
testing corrected). Small values indicate high significance.</td>
</tr>
<tr class="odd">
<td><code>p_val</code></td>
<td>Raw p-value from differential accessibility testing.</td>
</tr>
<tr class="even">
<td><code>avg_log2FC</code></td>
<td>Average log2 fold-change in accessibility in the indicated cell type
versus others; higher values indicate greater specificity.</td>
</tr>
<tr class="odd">
<td><code>region</code></td>
<td>Genomic interval as a string (e.g.,
<code>"chr7:142748901-142749963"</code>).</td>
</tr>
<tr class="even">
<td><code>RETSI</code></td>
<td>Regulatory Element Tissue Specificity Index; values near 1 indicate
high specificity of accessibility to this cell type.</td>
</tr>
<tr class="odd">
<td><code>RETSI_entropy</code></td>
<td>Entropy-based measure of specificity, with lower values indicating
more cell-type-specific accessibility.</td>
</tr>
<tr class="even">
<td><code>genes_HPAP, genes_nearest</code></td>
<td>Names of genes linked to the regulatory region using
co-accessibility or nearest-gene annotation.</td>
</tr>
<tr class="odd">
<td><code>GETSI</code></td>
<td>Gene Expression Tissue Specificity Index for linked genes,
indicating how specific gene expression is to the cell type.</td>
</tr>
<tr class="even">
<td><code>GETSI_entropy</code></td>
<td>Entropy-based measure of gene expression specificity, similar to
RETSI entropy but applied at the transcript level.</td>
</tr>
</tbody>
</table>
<hr>
<p>This annotated <code>GRanges</code> object thus serves as a
comprehensive resource combining genomic location, cell type-specific
accessibility, gene linkage, and expression specificity — facilitating
downstream functional genomics analyses.</p>
</div>
</div>
<div class="section level2">
<h2 id="visualization-example">Visualization example<a class="anchor" aria-label="anchor" href="#visualization-example"></a>
</h2>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Georgina Fuentes-Páez, Mireia Ramos-Rodriguez, Lorenzo Pasquali.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
